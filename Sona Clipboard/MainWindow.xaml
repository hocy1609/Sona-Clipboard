<Window
    x:Class="Sona_Clipboard.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:local="using:Sona_Clipboard"
    xmlns:tb="using:H.NotifyIcon"
    mc:Ignorable="d">

    <Window.SystemBackdrop>
        <MicaBackdrop Kind="Base"/>
    </Window.SystemBackdrop>

    <Grid>
        <Grid.Resources>
            <local:TypeToIconConverter x:Key="TypeToIconConverter"/>
        </Grid.Resources>

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid>
            <tb:TaskbarIcon 
                x:Name="TrayIcon"
                IconSource="/favicon.ico"
                ToolTipText="Sona Clipboard"
                DoubleClickCommand="{x:Bind ShowWindowCommand}" 
                >

                <tb:TaskbarIcon.ContextFlyout>
                    <MenuFlyout>
                        <MenuFlyoutItem Text="Открыть" Click="Open_Click" />
                        <MenuFlyoutSeparator />
                        <MenuFlyoutItem Text="Выход" Click="Exit_Click" />
                    </MenuFlyout>
                </tb:TaskbarIcon.ContextFlyout>
            </tb:TaskbarIcon>

        </Grid>

        <Grid x:Name="AppTitleBar" Height="40" Background="Transparent" Padding="15,0">
            <TextBlock Text="Sona Clipboard" VerticalAlignment="Center" FontSize="14" FontWeight="SemiBold"/>
        </Grid>

        <Grid Grid.Row="1" Padding="20">

            <Grid x:Name="HistoryView" Visibility="Visible">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <Grid Margin="0,0,0,15">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBox x:Name="SearchBox" PlaceholderText="Поиск..." TextChanged="SearchBox_TextChanged"/>
                    <Button x:Name="SettingsButton" Content="&#xE713;" FontFamily="Segoe MDL2 Assets" 
                            Grid.Column="1" Margin="10,0,0,0" Click="SettingsButton_Click"/>
                </Grid>

                <ListView x:Name="ClipboardList" Grid.Row="1" SelectionMode="None" IsItemClickEnabled="True" ItemClick="ClipboardList_ItemClick">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Grid Padding="10" CornerRadius="4" Margin="0,4" Background="#0AFFFFFF">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <FontIcon Glyph="{Binding Type, Converter={StaticResource TypeToIconConverter}}" 
                  FontFamily="Segoe MDL2 Assets" Margin="0,0,15,0" Opacity="0.6"/>

                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                    <TextBlock Text="{Binding DisplayText}" TextTrimming="CharacterEllipsis" MaxLines="1" FontWeight="Medium"/>
                                    <TextBlock Text="{Binding Timestamp}" FontSize="10" Opacity="0.5"/>
                                </StackPanel>

                                <Image Source="{Binding Thumbnail}" Grid.Column="2" Height="30" Stretch="Uniform" Margin="10,0,0,0"/>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>

                <TextBlock x:Name="EmptyStatusText" Grid.Row="1" Text="История пуста" 
                           HorizontalAlignment="Center" VerticalAlignment="Center" Opacity="0.5" Visibility="Collapsed"/>
            </Grid>


            <Grid x:Name="SettingsView" Visibility="Collapsed">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <Button x:Name="BackButton" Content="Назад" Click="BackButton_Click" Margin="0,0,0,15"/>

                <ScrollViewer Grid.Row="1">
                    <StackPanel Spacing="15">
                        <TextBlock Text="Настройки" FontSize="20" FontWeight="Bold"/>

                        <Border Background="#0FFFFFFF" CornerRadius="8" Padding="15">
                            <StackPanel Spacing="10">
                                <TextBlock Text="База данных" FontWeight="Bold"/>
                                <TextBlock x:Name="DbPathText" TextWrapping="Wrap" Opacity="0.7" FontSize="11"/>
                                <Button Content="Открыть папку" Click="OpenFolder_Click"/>
                            </StackPanel>
                        </Border>

                        <Border Background="#0FFFFFFF" CornerRadius="8" Padding="15">
                            <StackPanel Spacing="10">
                                <TextBlock Text="Горячие клавиши" FontWeight="Bold"/>

                                <TextBlock Text="Пред. элемент (Вверх):" Opacity="0.7" Margin="0,10,0,0"/>
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <CheckBox x:Name="HkNextCtrl" Content="Ctrl"/>
                                    <CheckBox x:Name="HkNextShift" Content="Shift"/>
                                    <CheckBox x:Name="HkNextAlt" Content="Alt"/>
                                    <ComboBox x:Name="HkNextKey" SelectedIndex="22" Width="80">
                                        <x:String>A</x:String>
                                        <x:String>B</x:String>
                                        <x:String>C</x:String>
                                        <x:String>D</x:String>
                                        <x:String>E</x:String>
                                        <x:String>F</x:String>
                                        <x:String>G</x:String>
                                        <x:String>H</x:String>
                                        <x:String>I</x:String>
                                        <x:String>J</x:String>
                                        <x:String>K</x:String>
                                        <x:String>L</x:String>
                                        <x:String>M</x:String>
                                        <x:String>N</x:String>
                                        <x:String>O</x:String>
                                        <x:String>P</x:String>
                                        <x:String>Q</x:String>
                                        <x:String>R</x:String>
                                        <x:String>S</x:String>
                                        <x:String>T</x:String>
                                        <x:String>U</x:String>
                                        <x:String>V</x:String>
                                        <x:String>W</x:String>
                                        <x:String>X</x:String>
                                        <x:String>Y</x:String>
                                        <x:String>Z</x:String>
                                    </ComboBox>
                                </StackPanel>

                                <TextBlock Text="След. элемент (Вниз):" Opacity="0.7" Margin="0,10,0,0"/>
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <CheckBox x:Name="HkPrevCtrl" Content="Ctrl"/>
                                    <CheckBox x:Name="HkPrevShift" Content="Shift"/>
                                    <CheckBox x:Name="HkPrevAlt" Content="Alt"/>
                                    <ComboBox x:Name="HkPrevKey" SelectedIndex="18" Width="80">
                                        <x:String>A</x:String>
                                        <x:String>B</x:String>
                                        <x:String>C</x:String>
                                        <x:String>D</x:String>
                                        <x:String>E</x:String>
                                        <x:String>F</x:String>
                                        <x:String>G</x:String>
                                        <x:String>H</x:String>
                                        <x:String>I</x:String>
                                        <x:String>J</x:String>
                                        <x:String>K</x:String>
                                        <x:String>L</x:String>
                                        <x:String>M</x:String>
                                        <x:String>N</x:String>
                                        <x:String>O</x:String>
                                        <x:String>P</x:String>
                                        <x:String>Q</x:String>
                                        <x:String>R</x:String>
                                        <x:String>S</x:String>
                                        <x:String>T</x:String>
                                        <x:String>U</x:String>
                                        <x:String>V</x:String>
                                        <x:String>W</x:String>
                                        <x:String>X</x:String>
                                        <x:String>Y</x:String>
                                        <x:String>Z</x:String>
                                    </ComboBox>
                                </StackPanel>

                                <Button Content="Применить клавиши" Click="ApplyHotKeys_Click"/>
                            </StackPanel>
                        </Border>

                        <Border Background="#0FFFFFFF" CornerRadius="8" Padding="15">
                            <StackPanel Spacing="10">
                                <TextBlock Text="Очистка" FontWeight="Bold"/>
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <TextBox x:Name="HistoryLimitBox" Text="100" Width="60"/>
                                    <Button Content="Лимит записей" Click="ApplyLimit_Click"/>
                                </StackPanel>
                                <Button Content="Удалить дубликаты" Click="RemoveDuplicates_Click"/>
                                <Button Content="Удалить все картинки" Click="RemoveImages_Click"/>
                                <Button Content="Удалить тяжелые (>2MB)" Click="RemoveHeavy_Click"/>
                                <Button Content="Очистить все" Foreground="Red" Click="ClearHistory_Click"/>
                                <TextBlock x:Name="MaintenanceStatus" Foreground="LimeGreen" FontSize="12"/>
                            </StackPanel>
                        </Border>

                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </Grid>
    </Grid>
</Window>